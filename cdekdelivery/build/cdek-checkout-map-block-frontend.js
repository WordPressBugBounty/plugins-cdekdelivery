(()=>{"use strict";var e={698:(e,i)=>{var o=Symbol.for("react.transitional.element");function t(e,i,t){var a=null;if(void 0!==t&&(a=""+t),void 0!==i.key&&(a=""+i.key),"key"in i)for(var c in t={},i)"key"!==c&&(t[c]=i[c]);else t=i;return i=t.ref,{$$typeof:o,type:e,key:a,ref:void 0!==i?i:null,props:t}}Symbol.for("react.fragment"),i.jsx=t,i.jsxs=t},848:(e,i,o)=>{e.exports=o(698)}},i={};function o(t){var a=i[t];if(void 0!==a)return a.exports;var c=i[t]={exports:{}};return e[t](c,c.exports,o),c.exports}o.n=e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return o.d(i,{a:i}),i},o.d=(e,i)=>{for(var t in i)o.o(i,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:i[t]})},o.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i);const t=window.wc.blocksCheckout,a=window.wp.element,c=window.wp.i18n,d=window.lodash,n=window.wc.wcSettings,s=window.CDEKWidget;var r=o.n(s),l=o(848);const f=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"cdek/checkout-map-block","version":"1.0.0","title":"CDEK Delivery Map","category":"widgets","description":"Adds a map on checkout to allow user select office to pickup from.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-shipping-methods-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}},"text":{"type":"string","default":""}},"textdomain":"cdekdelivery"}');(0,t.registerCheckoutBlock)({metadata:f,component:({checkoutExtensionData:e,extensions:i,cart:o,validation:t})=>{const{apiKey:s,officeDeliveryModes:f,lang:p}=(0,n.getSetting)("official_cdek_data"),[u,k]=(0,a.useState)(!1),[w,_]=(0,a.useState)(null),{setExtensionData:g}=e,{setValidationErrors:h,clearValidationError:m,getValidationError:v}=t,y=(0,d.debounce)(((e,i,o)=>{g(e,i,o)}),500),b=(0,a.useCallback)((0,d.debounce)(((e,i)=>{if(""===i||!o.cartNeedsShipping)return y("official_cdek","office_code",null),void m("official_cdek_office");const t=e.flatMap((e=>e.shipping_rates)).find((e=>e.selected));return t&&Object.prototype.hasOwnProperty.call(t,"method_id")&&"official_cdek"===t.method_id?-1===f.indexOf(parseInt(t.meta_data.find((e=>"_official_cdek_tariff_mode"===e.key)).value))?(y("official_cdek","office_code",null),void m("official_cdek_office")):(h({official_cdek_office:{message:(0,c.__)("Choose pick-up","cdekdelivery"),hidden:!0}}),void 0===window.widget?window.widget=new(r())({apiKey:s,lang:p,debug:!0,defaultLocation:e[0].destination.city,officesRaw:JSON.parse(i),hideDeliveryOptions:{door:!0},onChoose(e,i,o){y("official_cdek","office_code",o.code),m("official_cdek_office")}}):(window.widget.clearSelection(),window.widget.updateOfficesRaw(JSON.parse(i)),window.widget.updateLocation(e[0].destination.city)),void k(!0)):(y("official_cdek","office_code",null),void m("official_cdek_office"))}),1e3),[]);return(0,a.useEffect)((()=>{k(!1),o.isLoading||o.isLoadingRates||!i.official_cdek?m("official_cdek_office"):b(o.shippingRates,i.official_cdek.points||[])}),[o.isLoading,o.isLoadingRates,o.shippingRates,i.official_cdek]),(0,a.useEffect)((()=>{_(v("official_cdek_office"))})),(0,l.jsxs)("div",{className:"wp-block-shipping-cdek-map",style:{display:u?"block":"none"},children:[(0,l.jsx)("div",{id:"cdek-map",style:{height:"600px",border:!1===w?.hidden?"1px solid #cc1818":""}}),!1===w?.hidden&&(0,l.jsx)("div",{className:"wc-block-components-validation-error",role:"alert",children:(0,l.jsx)("p",{children:w.message})})]})}})})();